### 不可变模式

- 对象一旦被创建，状态就不再发生变化。也就是变量一旦被赋值，就不允许再修改了。

- 构建不可变类： 类的属性都设置为final,只允许存在只读方法，那么这个类就具备了不可变性；更严格的做法是将类设置为不可变的，防止
子类继承破坏不可变性
  
  
- jdk 中String、Long 、Integer、Double 等基础类就具有不可变性，这些对象的线程安全就是通过不可变性来保证的

#### 不可变类： String 

- String类提供了修改方法例如 replace, 但是返回的是修改后的新String ,原来的String 并没有改变

- 利用享元模式避免创建重复的对象，从而减少内存占用；本质上享元模式就是一个对象池，也就是创建前检查对象池是否已经创建，如果已经创建，直接从对象池获取


#### Integer 和 String 类型的对象不适合做锁，因为内部使用了享元模式，这会导致看上去私有的锁，实际上是共享的是同一个对象池内锁


### 不可变类的实现

- 将 class 自身声明为 final，这样别人就不能扩展来绕过限制了。
  
- 将所有成员变量定义为 private 和 final，并且不要实现 setter 方法。
  
- 通常构造对象时，成员变量使用深度拷贝来初始化，而不是直接赋值，这是一种防御措施，因为你无法确定输入对象不被其他人修改。
  
- 如果确实需要实现 getter 方法，或者其他可能会返回内部状态的方法，使用 copy-on-write 原则，创建私有的 copy。

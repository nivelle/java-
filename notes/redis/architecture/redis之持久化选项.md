
### 持久化选项

redis提供了两种不同的持久化方法来将数据存储到硬盘里.

## RDB

在执行save或者BGSAVE命令创建一个新的RDB文件时,程序会对数据库中的键进行检查,已经过期的键不会被保存到新创建的RDB文件中.因此,数据库中包含过期键不会对生成新的文件造成影响.

#### 载入RDB文件

在启动Redis服务器时,如果服务器开启了RDB功能,那么服务器将对RDB文件进行载入:

- 如果服务器以主服务器模式运行,那么在载入RDB文件时,程序会对文件中保存的键进行检查,未过期的键会被载入到数据库中,而过期的键则会被忽略

- 如果以从服务器模式运行,那么在载入RDB文件时,文件中保存的所有键,不论是否过期,都会被载入数据库中,不过,因为主从服务器在进行数据库同步的时候,从服务器的数据库就会被清空,所以一般来讲,过期键对载入RDB文件的从服务器也没影响.

### AOF文件写入

当服务器以AOF持久化模式运行时,如果数据库中的某个键已经过期,但它还没有被惰性删除或者定期删除,那么AOF文件不会因为这个过期键而产生任何影响.

当过期键被惰性删除或者定期删除之后,程序会向AOF文件追加一条DEL命令,来显示地记录该键已经被删除.


举个例子,如果客户端使用get message命令,试图访问过期的message键,那么服务器执行以下三个动:

- 从数据库中删除message键

- 追加一条del  message命令道AOF文件

- 向执行get命令的客户端返回空回复

### AOF重写

和生成RDB文件时类似,在执行AOF重写的过程中,程序会对数据库中的键进行检查,已过期的键不会被保存到重写后的AOF文件中

### 复制

当服务器运行在复制模式下时,从服务器的过期键删除动作由主服务器控制:

- 主服务器在删除一个过期键之后,会显示地向所有从服务器发送一个DEL命令,告知从服务器删除这个过期键

- 从服务器在执行客户端发送的读命令时,即使碰到过期键也不会将过期键删除,而是继续像处理未过期的键一样来处理过期键

- 从服务器只有在接到主服务器发来的DEL命令之后,才会删除过期键

### 数据库通知

数据库通知是redis2.8版本新增加的功能,这个功能可以让客户端通过订阅给定的频道或者模式,来或者数据中键的变化,以及数据中命令的执行情况.


### 常用SQL查询

````
desc  students;
+-------------+---------------------------------+------+-----+-------------------+-----------------------------------------------+
| Field       | Type                            | Null | Key | Default           | Extra                                         |
+-------------+---------------------------------+------+-----+-------------------+-----------------------------------------------+
| id          | int(20)                         | NO   | PRI | NULL              | auto_increment                                |
| name        | varchar(20)                     | NO   |     |                   |                                               |
| age         | int(10)                         | NO   |     | 0                 |                                               |
| high        | decimal(5,2)                    | NO   |     | 0.00              |                                               |
| gender      | enum('boy','girl','mid','hide') | NO   |     | hide              |                                               |
| cls_id      | int(20)                         | NO   |     | 0                 |                                               |
| create_time | timestamp                       | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED                             |
| update_time | timestamp                       | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED on update CURRENT_TIMESTAMP |
| yn          | tinyint(1)                      | NO   |     | 1                 |                                               |
+-------------+---------------------------------+------+-----+-------------------+-----------------------------------------------+
````

#### distinct 消除重复行,一种类型只取一种

````
select distinct(gender) from students; //查询性别种类

+--------+
| gender |
+--------+
| hide   |
| boy    |
| girl   |
+--------+

----------

select count(distinct(gender)) from students; //性别种类数

+-------------------------+
| count(distinct(gender)) |
+-------------------------+
|                       3 |
+-------------------------+
````

#### order by

````
select * from students where (age between 18 and 34) and gender = 1 order by high desc,age; //年龄在18到34岁之间,性别为男 按身高降序排列 如果身高一样则按照年龄升序排列
+----+--------+-----+--------+--------+--------+---------------------+---------------------+----+
| id | name   | age | high   | gender | cls_id | create_time         | update_time         | yn |
+----+--------+-----+--------+--------+--------+---------------------+---------------------+----+
|  7 | 老三   |  29 | 200.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |
|  9 | 老1    |  19 | 199.61 | boy    |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
|  2 | 老谢   |  28 | 188.88 | boy    |    111 | 2020-06-17 18:14:38 | 2020-06-17 18:14:38 |  1 |
|  3 | 老王   |  28 | 155.55 | boy    |    111 | 2020-06-17 18:14:38 | 2020-06-17 18:14:38 |  1 |
|  5 | 老李   |  28 | 100.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |
|  6 | 老狗   |  29 | 100.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |
|  4 | 老张   |  28 |  10.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |
+----+--------+-----+--------+--------+--------+---------------------+---------------------+----+

````

#### group by

````
select * from students group by gender; //默认满足分组条件的第一条数据
+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+
| id | name      | age | high   | gender | cls_id | create_time         | update_time         | yn |
+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+
|  1 | 班主任    |  18 | 172.66 | hide   |    111 | 2020-06-17 18:13:54 | 2020-06-17 18:13:54 |  1 |
|  2 | 老谢      |  28 | 188.88 | boy    |    111 | 2020-06-17 18:14:38 | 2020-06-17 18:14:38 |  1 |
| 10 | 老2       |   7 | 182.33 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+

select count(*),gender from students group by gender;//分组计数,分组内数据个数
+----------+--------+
| count(*) | gender |
+----------+--------+
|        1 | hide   |
|        8 | boy    |
|       18 | girl   |
+----------+--------+

 select gender,cls_id, count(*) from students group by gender, cls_id;//多个字段分组
 //组合分组字段如果能分在一个分组就按一个组,否则就新建一个分组
+--------+--------+----------+
| gender | cls_id | count(*) |
+--------+--------+----------+
| hide   |    111 |        1 |
| boy    |    111 |        8 |
| girl   |    111 |       17 |
| girl   |    112 |        1 |
+--------+--------+----------+

select count(*),gender,age from students where age>7 group by gender; //先过滤再分组,分组之后就不能过滤了
+----------+--------+-----+
| count(*) | gender | age |
+----------+--------+-----+
|        1 | hide   |  18 |
|        7 | boy    |  28 |
|       10 | girl   |  14 |
+----------+--------+-----+

select gender,age from students group by gender having age>7;//group by 之后只能加 having ,对分组后的数据进行过滤
+--------+-----+
| gender | age |
+--------+-----+
| hide   |  18 |
| boy    |  28 |
+--------+-----+

select sum(age),gender from students group by gender; //分组内的元素的和
+----------+--------+
| sum(age) | gender |
+----------+--------+
|       18 | hide   |
|      196 | boy    |
|      183 | girl   |
+----------+--------+

select gender,group_concat(name) from students group by gender having count(*) > 2; // 分组内个数大于2的
+--------+-----------------------------------------------------------------------------------------------------+
| gender | group_concat(name)                                                                                  |
+--------+-----------------------------------------------------------------------------------------------------+
| boy    | 老谢,老王,老张,老李,老狗,老三,老0,老1                                                               |
| girl   | 老2,老3,老4,老5,老6,老7,老8,老9,老10,老11,老12,老13,老14,老15,老16,老17,老18,老19                   |
+--------+-----------------------------------------------------------------------------------------------------+

select gender,group_concat(name) from students group by gender;
+--------+-----------------------------------------------------------------------------------------------------+
| gender | group_concat(name)                                                                                  |
+--------+-----------------------------------------------------------------------------------------------------+
| boy    | 老谢,老王,老张,老李,老狗,老三,老0,老1                                                               |
| girl   | 老2,老3,老4,老5,老6,老7,老8,老9,老10,老11,老12,老13,老14,老15,老16,老17,老18,老19                   |
| hide   | 班主任                                                                                              |
+--------+-----------------------------------------------------------------------------------------------------+

select sum(age),gender from students group by gender limit 1,2; //对分组后的数据进行分页;limit 放在最后面
+----------+--------+
| sum(age) | gender |
+----------+--------+
|      196 | boy    |
|      183 | girl   |
+----------+--------+
````

#### 统计group by 之后的count()

````
select count(*) from(SELECT count(*) FROM 表名 WHERE 条件 GROUP BY id ) a ;
````

#### 关联查询

``````
select s.id as sId,s.name sName,s.cls_id sclsId, c.id as cid ,c.name as cname from students as s inner join classes as c;// innner join s表和c表每一行数据关联 s(n)*c(n)
+-----+-----------+--------+-----+---------------+
| sId | sName     | sclsId | cid | cname         |
+-----+-----------+--------+-----+---------------+
|   1 | 班主任    |    111 | 111 | 测试班级      |
|   1 | 班主任    |    111 | 112 | 测试班级2     |
|   2 | 老谢      |    111 | 111 | 测试班级      |
|   2 | 老谢      |    111 | 112 | 测试班级2     |
|   3 | 老王      |    111 | 111 | 测试班级      |
|   3 | 老王      |    111 | 112 | 测试班级2     |
|   4 | 老张      |    111 | 111 | 测试班级      |
|   4 | 老张      |    111 | 112 | 测试班级2     |
|   5 | 老李      |    111 | 111 | 测试班级      |
|   5 | 老李      |    111 | 112 | 测试班级2     |
|   6 | 老狗      |    111 | 111 | 测试班级      |
|   6 | 老狗      |    111 | 112 | 测试班级2     |
|   7 | 老三      |    111 | 111 | 测试班级      |
|   7 | 老三      |    111 | 112 | 测试班级2     |
|   8 | 老0       |    111 | 111 | 测试班级      |
|   8 | 老0       |    111 | 112 | 测试班级2     |
|   9 | 老1       |    111 | 111 | 测试班级      |
|   9 | 老1       |    111 | 112 | 测试班级2     |
|  10 | 老2       |    111 | 111 | 测试班级      |
|  10 | 老2       |    111 | 112 | 测试班级2     |
|  11 | 老3       |    111 | 111 | 测试班级      |
|  11 | 老3       |    111 | 112 | 测试班级2     |
|  12 | 老4       |    111 | 111 | 测试班级      |
|  12 | 老4       |    111 | 112 | 测试班级2     |
|  13 | 老5       |    111 | 111 | 测试班级      |
|  13 | 老5       |    111 | 112 | 测试班级2     |
|  14 | 老6       |    111 | 111 | 测试班级      |
|  14 | 老6       |    111 | 112 | 测试班级2     |
|  15 | 老7       |    111 | 111 | 测试班级      |
|  15 | 老7       |    111 | 112 | 测试班级2     |
|  16 | 老8       |    111 | 111 | 测试班级      |
|  16 | 老8       |    111 | 112 | 测试班级2     |
|  17 | 老9       |    111 | 111 | 测试班级      |
|  17 | 老9       |    111 | 112 | 测试班级2     |
|  18 | 老10      |    111 | 111 | 测试班级      |
|  18 | 老10      |    111 | 112 | 测试班级2     |
|  19 | 老11      |    111 | 111 | 测试班级      |
|  19 | 老11      |    111 | 112 | 测试班级2     |
|  20 | 老12      |    111 | 111 | 测试班级      |
|  20 | 老12      |    111 | 112 | 测试班级2     |
|  21 | 老13      |    111 | 111 | 测试班级      |
|  21 | 老13      |    111 | 112 | 测试班级2     |
|  22 | 老14      |    111 | 111 | 测试班级      |
|  22 | 老14      |    111 | 112 | 测试班级2     |
|  23 | 老15      |    111 | 111 | 测试班级      |
|  23 | 老15      |    111 | 112 | 测试班级2     |
|  24 | 老16      |    111 | 111 | 测试班级      |
|  24 | 老16      |    111 | 112 | 测试班级2     |
|  25 | 老17      |    111 | 111 | 测试班级      |
|  25 | 老17      |    111 | 112 | 测试班级2     |
|  26 | 老18      |    111 | 111 | 测试班级      |
|  26 | 老18      |    111 | 112 | 测试班级2     |
|  27 | 老19      |    111 | 111 | 测试班级      |
|  27 | 老19      |    111 | 112 | 测试班级2     |
+-----+-----------+--------+-----+---------------+

select s.id as sId,s.name sName,s.cls_id sclsId, c.id as cid ,c.name as cname from students as s inner join classes as c on s.cls_id = c.id; // innner join s表和c表 数据关联 满足 on 关联条件
+-----+-----------+--------+-----+--------------+
| sId | sName     | sclsId | cid | cname        |
+-----+-----------+--------+-----+--------------+
|   1 | 班主任    |    111 | 111 | 测试班级     |
|   2 | 老谢      |    111 | 111 | 测试班级     |
|   3 | 老王      |    111 | 111 | 测试班级     |
|   4 | 老张      |    111 | 111 | 测试班级     |
|   5 | 老李      |    111 | 111 | 测试班级     |
|   6 | 老狗      |    111 | 111 | 测试班级     |
|   7 | 老三      |    111 | 111 | 测试班级     |
|   8 | 老0       |    111 | 111 | 测试班级     |
|   9 | 老1       |    111 | 111 | 测试班级     |
|  10 | 老2       |    111 | 111 | 测试班级     |
|  11 | 老3       |    111 | 111 | 测试班级     |
|  12 | 老4       |    111 | 111 | 测试班级     |
|  13 | 老5       |    111 | 111 | 测试班级     |
|  14 | 老6       |    111 | 111 | 测试班级     |
|  15 | 老7       |    111 | 111 | 测试班级     |
|  16 | 老8       |    111 | 111 | 测试班级     |
|  17 | 老9       |    111 | 111 | 测试班级     |
|  18 | 老10      |    111 | 111 | 测试班级     |
|  19 | 老11      |    111 | 111 | 测试班级     |
|  20 | 老12      |    111 | 111 | 测试班级     |
|  21 | 老13      |    111 | 111 | 测试班级     |
|  22 | 老14      |    111 | 111 | 测试班级     |
|  23 | 老15      |    111 | 111 | 测试班级     |
|  24 | 老16      |    111 | 111 | 测试班级     |
|  25 | 老17      |    111 | 111 | 测试班级     |
|  26 | 老18      |    111 | 111 | 测试班级     |
|  27 | 老19      |    111 | 111 | 测试班级     |
+-----+-----------+--------+-----+--------------+

select * from students left join classes on students.cls_id=classes.id; //以左表为主表与右表满足条件的数据关联

+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+------+--------------+---------------------+---------------------+------+
| id | name      | age | high   | gender | cls_id | create_time         | update_time         | yn | id   | name         | create_time         | update_time         | yn   |
+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+------+--------------+---------------------+---------------------+------+
|  1 | 班主任    |  18 | 172.66 | hide   |    111 | 2020-06-17 18:13:54 | 2020-06-17 18:13:54 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
|  2 | 老谢      |  28 | 188.88 | boy    |    111 | 2020-06-17 18:14:38 | 2020-06-17 18:14:38 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
|  3 | 老王      |  28 | 155.55 | boy    |    111 | 2020-06-17 18:14:38 | 2020-06-17 18:14:38 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
|  4 | 老张      |  28 |  10.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
|  5 | 老李      |  28 | 100.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
|  6 | 老狗      |  29 | 100.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
|  7 | 老三      |  29 | 200.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
|  8 | 老0       |   7 | 179.25 | boy    |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
|  9 | 老1       |  19 | 199.61 | boy    |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 10 | 老2       |   7 | 182.33 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 11 | 老3       |  14 | 174.47 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 12 | 老4       |  17 | 196.08 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 13 | 老5       |  10 | 162.10 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 14 | 老6       |  13 | 193.28 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 15 | 老7       |  18 | 189.02 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 16 | 老8       |  15 | 199.05 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 17 | 老9       |   6 | 177.54 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 18 | 老10      |   5 | 166.55 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 19 | 老11      |   5 | 161.34 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 20 | 老12      |  13 | 165.38 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 21 | 老13      |   5 | 188.21 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 22 | 老14      |   5 | 174.80 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 23 | 老15      |   6 | 195.50 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 24 | 老16      |  15 | 164.25 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 25 | 老17      |  10 | 160.66 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 26 | 老18      |   7 | 186.75 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
| 27 | 老19      |  12 | 173.04 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |  111 | 测试班级     | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |    1 |
+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+------+--------------+---------------------+---------------------+------+


select * from students right join classes on students.cls_id=classes.id; //以右表为主表与左表满足条件的数据关联
+------+-----------+------+--------+--------+--------+---------------------+---------------------+------+-----+---------------+---------------------+---------------------+----+
| id   | name      | age  | high   | gender | cls_id | create_time         | update_time         | yn   | id  | name          | create_time         | update_time         | yn |
+------+-----------+------+--------+--------+--------+---------------------+---------------------+------+-----+---------------+---------------------+---------------------+----+
|    1 | 班主任    |   18 | 172.66 | hide   |    111 | 2020-06-17 18:13:54 | 2020-06-17 18:13:54 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|    2 | 老谢      |   28 | 188.88 | boy    |    111 | 2020-06-17 18:14:38 | 2020-06-17 18:14:38 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|    3 | 老王      |   28 | 155.55 | boy    |    111 | 2020-06-17 18:14:38 | 2020-06-17 18:14:38 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|    4 | 老张      |   28 |  10.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|    5 | 老李      |   28 | 100.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|    6 | 老狗      |   29 | 100.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|    7 | 老三      |   29 | 200.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|    8 | 老0       |    7 | 179.25 | boy    |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|    9 | 老1       |   19 | 199.61 | boy    |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   10 | 老2       |    7 | 182.33 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   11 | 老3       |   14 | 174.47 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   12 | 老4       |   17 | 196.08 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   13 | 老5       |   10 | 162.10 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   14 | 老6       |   13 | 193.28 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   15 | 老7       |   18 | 189.02 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   16 | 老8       |   15 | 199.05 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   17 | 老9       |    6 | 177.54 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   18 | 老10      |    5 | 166.55 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   19 | 老11      |    5 | 161.34 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   20 | 老12      |   13 | 165.38 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   21 | 老13      |    5 | 188.21 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   22 | 老14      |    5 | 174.80 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   23 | 老15      |    6 | 195.50 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   24 | 老16      |   15 | 164.25 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   25 | 老17      |   10 | 160.66 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   26 | 老18      |    7 | 186.75 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
|   27 | 老19      |   12 | 173.04 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |    1 | 111 | 测试班级      | 2020-06-17 23:31:02 | 2020-06-17 23:31:02 |  1 |
| NULL | NULL      | NULL |   NULL | NULL   |   NULL | NULL                | NULL                | NULL | 112 | 测试班级2     | 2020-06-17 23:31:17 | 2020-06-17 23:31:17 |  1 |
+------+-----------+------+--------+--------+--------+---------------------+---------------------+------+-----+---------------+---------------------+---------------------+----+
``````

#### 子查询

##### 标量子查询: 子查询返回的结果是一个数据(一行一列)

``````
select * from students where high > (select avg(high) from students);
+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+
| id | name      | age | high   | gender | cls_id | create_time         | update_time         | yn |
+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+
|  1 | 班主任    |  18 | 172.66 | hide   |    111 | 2020-06-17 18:13:54 | 2020-06-17 18:13:54 |  1 |
|  2 | 老谢      |  28 | 188.88 | boy    |    111 | 2020-06-17 18:14:38 | 2020-06-17 18:14:38 |  1 |
|  7 | 老三      |  29 | 200.00 | boy    |    111 | 2020-06-17 18:16:53 | 2020-06-17 18:16:53 |  1 |
|  8 | 老0       |   7 | 179.25 | boy    |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
|  9 | 老1       |  19 | 199.61 | boy    |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 10 | 老2       |   7 | 182.33 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 11 | 老3       |  14 | 174.47 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 12 | 老4       |  17 | 196.08 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 14 | 老6       |  13 | 193.28 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 15 | 老7       |  18 | 189.02 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 16 | 老8       |  15 | 199.05 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 17 | 老9       |   6 | 177.54 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 21 | 老13      |   5 | 188.21 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 22 | 老14      |   5 | 174.80 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 23 | 老15      |   6 | 195.50 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 26 | 老18      |   7 | 186.75 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
| 27 | 老19      |  12 | 173.04 | girl   |    111 | 2020-06-17 18:27:48 | 2020-06-17 18:27:48 |  1 |
+----+-----------+-----+--------+--------+--------+---------------------+---------------------+----+
``````

##### 列子查询: 返回的结果是一列(一列多行)

``````
select id,name from students where cls_id in (select id from classes); //子查询为 id列的多行数据
+----+-----------+
| id | name      |
+----+-----------+
|  1 | 班主任    |
|  2 | 老谢      |
|  3 | 老王      |
|  4 | 老张      |
|  5 | 老李      |
|  6 | 老狗      |
|  7 | 老三      |
|  8 | 老0       |
|  9 | 老1       |
| 10 | 老2       |
| 11 | 老3       |
| 12 | 老4       |
| 13 | 老5       |
| 14 | 老6       |
| 15 | 老7       |
| 16 | 老8       |
| 17 | 老9       |
| 18 | 老10      |
| 19 | 老11      |
| 20 | 老12      |
| 21 | 老13      |
| 22 | 老14      |
| 23 | 老15      |
| 24 | 老16      |
| 25 | 老17      |
| 26 | 老18      |
| 27 | 老19      |
+----+-----------+
``````

### 行子查询: 返回的结果是一行(一行多列)

### sql 执行顺序

FROM > WHERE > GROUP BY > HAVING > SELECT的字段 > DISTINCT > ORDER BY > LIMIT

### 库

#### 创建数据库

```
CREATE DATABASE javaguideslave;

```

#### 指定编码

```
drop database if EXISTS teambuild;
create database teambuild CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```





#### 查看数据库版本

```
select version();

+-----------+
| version() |
+-----------+
| 8.0.16    |
+-----------+
```

#### 查看数据库隔离级别(默认RR重复读)

```
mysql> select @@global.tx_isolation;
+-----------------------+
| @@global.tx_isolation |
+-----------------------+
| REPEATABLE-READ       |
+-----------------------+
```

#### 查看当前默认的数据库引擎

```
show engines;  

+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |
| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |
| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
```

#### 查看当前的查询状态

```

show processlist;

```

#### 创建账号

```
create user 'root'@'%' identified with mysql_native_password by 'Nivelle123';
```

#### 给当前账号授权

```
GRANT ALL PRIVILEGES ON javaguides.* TO 'root'@'localhost' IDENTIFIED BY 'Nivelle123' WITH GRANT OPTION;

```

#### 查看数据库

```
show databases;

```

#### 使用某个数据库

```
use databases;

```

#### 删除某个数据库

```
drop database databasesName;

```

---

### 表

#### 初始化表

```
DROP TABLE IF EXISTS `activity`;
CREATE TABLE `activity` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `activity_id` varchar(32) NOT NULL default '' COMMENT '活动id',
  `position_type` tinyint(10) NOT NULL default 0 COMMENT '广告位置 1.活动页 2.首页',
  `ip` varchar (15) NOT NULL DEFAULT '' COMMENT 'ip地址',
  `type` varchar(32) NOT NULL default '' COMMENT '设备类型',
  `device_no` varchar (32) NOT NULL default '' COMMENT '设备号',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

```

#### 查看所有表

```
show tables;
```

#### 删除表

```
drop table tableName;
```

#### 修改表名

```
alter table oldTableName rename to newTableName;
```

#### 修改列

```
alter table tableName change oldName newName;

```

#### 添加列

```
alter table tableName add column 列名 类型；

```

#### 修改列属性

```
alter table 表名 modify name varchar(22);

```

#### 删除整个表数据后整理表

```
alter table A engine=InnoDB;

```

---

### order by 的执行原理

````

CREATE TABLE `t` (
  `id` int(11) NOT NULL,
  `city` varchar(16) NOT NULL,
  `name` varchar(16) NOT NULL,
  `age` int(11) NOT NULL,
  `addr` varchar(128) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `city` (`city`)
) ENGINE=InnoDB;

````

````
select city,name,age from t where city='杭州' order by name limit 1000  ;

````

#### 全字段排序

- MySQL 会给每个线程分配一块内存用于排序，称为 sort_buffer。

1. 初始化 sort_buffer，确定放入 name、city、age 这三个字段；

2. 从索引找到第一个满足city='杭州'条件的主键id；

3. 到主键id 索引取出整行，取name,city,age三个字段，存入sort_buffer中；

4. 从索引city取下一个记录的主键id

5. 重复3、4直到city的值不满足查询条件为止

6. 对sort_buffer中的数据安装字段name做快速排序

7. 按照排序结果取前1000行给客户端

[![y3fkz6.md.jpg](https://s3.ax1x.com/2021/02/04/y3fkz6.md.jpg)](https://imgchr.com/i/y3fkz6)

- sort_buffer_size，就是 MySQL 为排序开辟的内存（sort_buffer）的大小。如果要排序的数据量小于
  sort_buffer_size，排序就在内存中完成。但如果排序数据量太大，内存放不下，则不得不利用磁盘临时文件辅助排序。

- 外部排序一般使用归并排序算法。可以这么简单理解，MySQL 将需要排序的数据分成 12 份，每一份单独排序后存在这些临时文件中。然后把这 12 个有序文件再合并成一个有序的大文件

#### rowid排序

- 如果查询要返回的字段很多的话，那么 sort_buffer 里面要放的字段数太多，这样内存里能够同时放下的行数很少，要分成很多个临时文件，排序的性能会很差

- max_length_for_sort_data，是 MySQL 中专门控制用于排序的行数据的长度的一个参数。它的意思是，如果单行的长度超过这个值，MySQL 就认为单行太大，要换一个算法

- ort_buffer 的字段，只有要排序的列（即 name 字段）和主键 i

1. 初始化 sort_buffer，确定放入两个字段，即 name 和 id；

2. 从索引 city 找到第一个满足 city='杭州’条件的主键 id

3. 到主键 id 索引取出整行，取 name、id 这两个字段，存入 sort_buffer 中

4. 从索引 city 取下一个记录的主键 id

5. 重复步骤 3、4 直到不满足 city='杭州’条件为止

6. 对 sort_buffer 中的数据按照字段 name 进行排序；

7. 遍历排序结果，取前 1000 行，并按照 id 的值回到原表中取出 city、name 和 age 三个字段返回给客户端。

[![y35nwF.md.jpg](https://s3.ax1x.com/2021/02/04/y35nwF.md.jpg)](https://imgchr.com/i/y35nwF)

#### 比较

- 如果 MySQL 实在是担心排序内存太小，会影响排序效率，才会采用 rowid 排序算法，这样排序过程中一次可以排序更多行，但是需要再回到原表去取数据。

- 如果 MySQL 认为内存足够大，会优先选择全字段排序，把需要的字段都放到 sort_buffer 中，这样排序后就会直接从内存里面返回查询结果了，不用再回到原表去取数据。

- 这也就体现了 MySQL 的一个设计思想：如果内存够，就要多利用内存，尽量减少磁盘访问。对于 InnoDB 表来说，rowid 排序会要求回表多造成磁盘读，因此不会被优先选择。

#### 建立 （city,name）联合索引

````
alter table t add index city_user(city, name);

````

1. 从索引 (city,name) 找到第一个满足 city='杭州’条件的主键 id；

2. 到主键 id 索引取出整行，取 name、city、age 三个字段的值，作为结果集的一部分直接返回；

3. 从索引 (city,name) 取下一个记录主键 id；

4. 重复步骤 2、3，直到查到第 1000 条记录，或者是不满足 city='杭州’条件时循环结束

[![y3II4H.md.jpg](https://s3.ax1x.com/2021/02/05/y3II4H.md.jpg)](https://imgchr.com/i/y3II4H)

#### 建立（city,name,age）覆盖索引

````

alter table t add index city_user_age(city, name, age);
````

1. 从索引 (city,name,age) 找到第一个满足 city='杭州’条件的记录，取出其中的 city、name 和 age 这三个字段的值，作为结果集的一部分直接返回；

2. 从索引 (city,name,age) 取下一个记录，同样取出这三个字段的值，作为结果集的一部分直接返回；

3. 重复执行步骤 2，直到查到第 1000 条记录，或者是不满足 city='杭州’条件时循环结束。

[![y3oAbT.md.jpg](https://s3.ax1x.com/2021/02/05/y3oAbT.md.jpg)](https://imgchr.com/i/y3oAbT)

#### 索引下推

````

CREATE TABLE `tuser` (
  `id` int(11) NOT NULL,
  `id_card` varchar(32) DEFAULT NULL,
  `name` varchar(32) DEFAULT NULL,
  `age` int(11) DEFAULT NULL,
  `ismale` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `id_card` (`id_card`),
  KEY `name_age` (`name`,`age`)
) ENGINE=InnoDB

````

- 这个语句在搜索索引树的时候，只能用 “张”，找到第一个满足条件的记录 ID3

- 在 MySQL 5.6 之前，只能从 ID3 开始一个个回表。到主键索引上找出数据行，再对比字段值

[![yJ8gQx.md.jpg](https://s3.ax1x.com/2021/02/05/yJ8gQx.md.jpg)](https://imgchr.com/i/yJ8gQx)

- MySQL 5.6 引入的索引下推优化（index condition pushdown)， 可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数

[![yJ8oYd.jpg](https://s3.ax1x.com/2021/02/05/yJ8oYd.jpg)](https://imgchr.com/i/yJ8oYd)


